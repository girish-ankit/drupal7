<?php
// $Id$


function custom_db_query_menu()
{
	$items = array();
	$items['custom-db-query'] = array( 
	                               'title' => t('Custom Db Query'),
		                       'page callback' => 'custom_db_query',
				        'access arguments' => array('access content'),
					 'type' =>MENU_NORMAL_ITEM,
									
		                          );
	$items['custom-db-query/first'] = array(
	                                     'title' => t('Simple Query '),
		                           //'page callback' => 'first_menu_default_tab',
					      'access arguments' => array('access content'),
					      'type' => MENU_DEFAULT_LOCAL_TASK,
					      'weight' => 1,
		                          );
	$items['custom-db-query/first/tab'] = array(
	                                         'title' => t('db_query'),
		                                //'page callback' => 'first_menu_default_tab',
						  'access arguments' => array('access content'),
						  'type' => MENU_DEFAULT_LOCAL_TASK,
		                          );
	$items['custom-db-query/first/tab1'] = array( 
	                                           'title' => t('fetchfield'),
		                                   'page callback' => 'first_menu_tab_first_tab1',
						    'access arguments' => array('access content'),
						    'type' => MENU_LOCAL_TASK,
		                          );
	$items['custom-db-query/first/tab2'] = array( 
	                                          'title' => t('Query Object'),
		                                  'page callback' => 'first_menu_tab_second_tab1',
						   'access arguments' => array('access content'),
						   'type' => MENU_LOCAL_TASK,
		                          );
	
	$items['custom-db-query/second'] = array( 
	                                       'title' => t('Pager Query'),
		                               'page callback' => 'second_menu_tab_default_tab1',
						'access arguments' => array('access content'),
						'type'=> MENU_LOCAL_TASK,
						'weight'=>2
		                          );
	$items['custom-db-query/second/tab'] = array( 
	                                         'title' => t('Simple pager query'),
		                                 //'page callback' => 'second_menu_tab_default_tab',
					          'access arguments' => array('access content'),
						   'type'=> MENU_DEFAULT_LOCAL_TASK,
								''
		                          );
	$items['custom-db-query/second/tab1'] = array( 
	                                          'title' => t('Tabular pager query'),
		                                  'page callback' => 'second_menu_tab_second_tab1',
						   'access arguments' => array('access content'),
						   'type'=> MENU_LOCAL_TASK,
								''
		                          );
  $items['custom-db-query/second/tab2'] = array( 
	                                          'title' => t('Tabular pager query with sorting'),
		                                  'page callback' => 'second_menu_tab_second_tab2',
						   'access arguments' => array('access content'),
						   'type'=> MENU_LOCAL_TASK,
								''
		                          );
	return $items;
}

function custom_db_query()
{
	$output = '';
	$output .= '<ul>';
	$result =  db_query("SELECT nid, title FROM {node} WHERE type = :type AND status = :status", array(':type' => 'page', ':status' => 1));
	foreach($result as $row){
		$path = 'node/'.$row->nid;
		$output .= "<li>".l($row->title, $path)."</li>";
	}
	$output .= '</ul>';
	
	return $output;

}



function first_menu_tab_first_tab1()
{
	$nbr_records = db_query("SELECT COUNT(nid) FROM {node} WHERE type = :type AND status = :status", array(':type' => 'page', ':status' => 1))->fetchField();
	
	return "<b>Total Number of nodes of page type: </b>".$nbr_records;
}


function first_menu_tab_second_tab1()
{
	$output = '';
	$query = db_select("node", "n")
	        ->condition('type', 'article')
	        ->fields('n', array('nid', 'title'))
	        ->range(0, 10);
	        
	$result = $query->execute();
	$output .= '<ul>';
	foreach($result as $rows){
		$path = 'node/'.$rows->nid;
		$output .= "<li>".l($rows->title, $path)."</li>";
             }
    $output .= '</ul>';
	return $output;
}
function second_menu_tab_default_tab1()
{
	$output = '';
	$query = db_select("node", "n")
	        ->extend('PagerDefault')
	        ->condition('type', 'article')
	        ->fields('n', array('nid', 'title'))
	        ->limit(5);
	        
	$result = $query->execute();
	
	foreach($result as $rows){
		$path = 'node/'.$rows->nid;
		$output .= l($rows->title, $path)."<br />";
             }
    $output .= theme('pager');
	return $output;
}



function second_menu_tab_second_tab1()
{
	$output = '';
	$header = array('Title', 'View', 'Edit', 'Delete', 'Created');
	
	$query = db_select('node', 'n')
	        ->extend('PagerDefault')
	        ->condition('type', 'article')
	        ->fields('n', array('nid', 'title', 'created'))
	        ->limit(20);
	        
	$result = $query->execute();
	
	
	$data = array();
	
	foreach($result as $rows){
		$path   = 'node/'.$rows->nid;
		$edit   = 'node/'.$rows->nid.'/edit';
		$delete = 'node/'.$rows->nid.'/delete';
		$data[] = array($rows->title, l('view', $path), l('Edit', $edit), l('Delete', $delete), date("d/m/Y", $rows->created));
		
             }
    $output .= theme('table', array('header' => $header, 'rows' => $data, 'caption' => 'Creating Drupal 7 style tables', 'sticky' => TRUE, 'empty' => 'No nodes created...', 'id'=>'my-custom-id', 'class'=>'my-custom-class', 'border'=>3));
    
    $output .= theme('pager');
	return $output;
}

function second_menu_tab_second_tab2()
{
	$output = '';
	
	$header = array(
	                 array('data' => t('Title'), 'field' => 'title', 'sort' => 'asc'),
		             array('data' => t('View')),
		             array('data' => t('Edit')),
		             array('data' => t('Delete')),
				     array('data' => t('Date'), 'field' => 'created', 'sort' => 'desc'),
		                 );
	
	$query = db_select('node', 'n')
	        ->condition('type', 'article')
            ->condition('status', 1) 
            ->extend('PagerDefault')     //Pager Extender
            ->limit(10)              //10 results per page
            ->extend('TableSort')        //Sorting Extender
             ->orderByHeader($header)//Field to sort on is picked from $header
            ->fields ('n', array ('nid','title','created'));

 

$result = $query->execute();

	$data = array();
	
	foreach($result as $rows){
		$path   = 'node/'.$rows->nid;
		$edit   = 'node/'.$rows->nid.'/edit';
		$delete = 'node/'.$rows->nid.'/delete';
		$data[] = array($rows->title, l('view', $path), l('Edit', $edit), l('Delete', $delete), date("d/m/Y", $rows->created));
		
             }
    $output .= theme('table', array('header' => $header, 'rows' => $data));
    $output .= theme('pager');
	return $output;
}


