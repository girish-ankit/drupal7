<?php
// $Id$
/**
*@file
* This file is created to show custom pager creation in drupal.
* 
*/






/**
* Implementation of hook_menu()
*/



function custom_query_caching_menu()
{
	$items = array();
	$items['custom-query-caching'] = array(
                          'title' => t('Custom Query Caching'),
		          'page callback' => 'custom_query_caching_demo',
		          'access callback' => TRUE,
		          'type' =>MENU_NORMAL_ITEM,
		                  );

    $items['custom-query-caching/time'] = array(
                          'title' => t('Custom Query Caching time'),
		          'page callback' => 'custom_query_caching_demo_time',
		          'access callback' => TRUE,
		          'type' =>MENU_NORMAL_ITEM,
		                  );


	
	
	
	return $items;
}


function custom_query_caching_demo(){

$ankit = ankit();
$kajal = kajal();

return $ankit.'---'.$kajal;


}

function ankit(){
drupal_set_message('Ankit function call');
 return data_test();

}

function kajal(){
drupal_set_message('Kajal function call');
 return data_test();

}

function data_test(){

$my_data = &drupal_static(__FUNCTION__);
  if (!isset($my_data)) {
    if ($cache = cache_get('custom_query_data')) {

          
      $my_data = $cache->data;
      drupal_set_message('from cache');
    }
    else {
      // Do your expensive calculations here, and populate $my_data
      // with the correct stuff..
       $my_data = 'ankit : '. date("d/m/Y : h i a", time());
      cache_set('custom_query_data', $my_data, 'cache', time() + 60*10);
      drupal_set_message('fresh data');
    }
  }else{
     drupal_set_message('static data');
}
  return $my_data;
}


function custom_query_caching_demo_time(){
 
global $language;
  // we take caching time in min
  $cachingTime = 2*60; 
  $cacheName = 'data';
  $cacheNameWithLanguage = $cacheName.'-'.$language->language;

  

  if($cache = cache_get($cacheNameWithLanguage)){
      if($cache->created < time()-$cachingTime){
          drupal_set_message('data updated');
        // Starts output function
          $my_data = 'data '.date("d-m-Y : H i s", time());
        // Ends output function
         cache_set($cacheNameWithLanguage, $my_data, 'cache', time() + $cachingTime);
         return $my_data;
	}else{
            drupal_set_message('cached data');
          return $cache->data;
	}
}else{
      drupal_set_message('fresh data');
         // Starts output function
          $my_data = 'data '.date("d-m-Y : H i s", time());
        // Ends output function
       cache_set($cacheNameWithLanguage, $my_data, 'cache', time() + $cachingTime);
       return $my_data;
     }

}



